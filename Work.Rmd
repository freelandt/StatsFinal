---
title: "WorkFile"
author: "Trevor Freeland"
date: "May 30, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(stargazer)
library(lme4)
library(tidyr)
library(MASS)
library(pscl)

model.counts <- source("http://math.carleton.edu/Chihara/Stats345/Count_Function.R")$value
```

```{r}
#Does the data read
VideoGames <- read.csv("VideoGames.csv") #16719 cases
VideoGames$Year_of_Release <- as.numeric(as.character(VideoGames$Year_of_Release))
VideoGames$User_Score <- as.numeric(as.character(VideoGames$User_Score))
VideoGames <- na.omit(VideoGames) #6894 full cases. 
VideoGames$Rating2 <- as.factor(ifelse(VideoGames$Rating %in% c("E", "E10+", "M", "T"), as.character(VideoGames$Rating), "No Rating"))

#Create "Other" category for publishers/developers that worked on 10 games or less
Publishers <- VideoGames %>% group_by(Publisher) %>% summarize(n = n())
Publishers$Publisher2 <- as.factor(ifelse(Publishers$n > 10, as.character(Publishers$Publisher), "Other"))
VideoGames2 <- merge(VideoGames, Publishers[,c(1,3)], by.x = "Publisher", by.y = "Publisher")

Developers <- VideoGames %>% group_by(Developer) %>% summarize(n = n())
Developers$Developer2 <- as.factor(ifelse(Developers$n > 10, as.character(Developers$Developer), "Other"))
VideoGames2 <- merge(VideoGames2, Developers[,c(1,3)], by.x = "Developer", by.y = "Developer")

VideoGames2$Critic_Score2 <- VideoGames2$Critic_Score/10
VideoGames2$Year2 <- VideoGames2$Year_of_Release - 1985
```

##Some EDA

```{r}
edaData <- VideoGames %>% gather(Region, Sales, c("NA_Sales", "EU_Sales", "JP_Sales", "Other_Sales"))

edaData2 <- edaData %>% group_by(Region, Genre) %>% mutate(Percent = Sales/sum(Global_Sales))

ggplot(edaData2, aes(x = Genre, y = Percent, fill = Region)) + geom_bar(stat = "identity")

ggplot(edaData, aes(x = Genre, y = Sales, fill = Region)) + geom_bar(stat = "identity")

ggplot(VideoGames2, aes(x = Platform, y = NA_Sales)) + geom_boxplot() + 
  ggtitle("Figure 1a: North America Sales by Platform") + 
  labs(x = "Video Game Platform", y = "NA Sales")

VideoGamesPub <- subset(VideoGames2, subset = Publisher2 %in% c("Activision", "Bethesda Softworks", "Electronic Arts", "Konami Digital Entertainment", "Microsoft Game Studios", "Nintendo", "Sega", "Sony Computer Entertainment", "Square Enix", "Ubisoft"))
ggplot(VideoGamesPub, aes(x = Publisher2, y = NA_Sales)) + geom_boxplot() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  ggtitle("Figure 1b: North America Sales by Publisher") + 
  labs(x = "Video Game Publisher", y = "NA Sales")
```

```{r}
temp <- VideoGames %>% filter(NA_Sales >0, EU_Sales >0, JP_Sales > 0)

temp <- VideoGames %>% group_by(Developer) %>% summarise(n = n())

temp2 <- temp %>% filter(n > 10)
hist(temp$n)
```

```{r}
na.hurdle <- hurdle((NA_Sales*100)~Platform+Year2+Genre+User_Score+Critic_Score2+Rating2+Publisher2, data = VideoGames2)
summary(na.hurdle)

na.hurdle2 <- hurdle((NA_Sales*100)~Platform+Genre+User_Score+Critic_Score2+Rating2+Publisher2|Platform+Year2+Genre+User_Score+Critic_Score2+Rating2, data = VideoGames2)
AIC(na.hurdle); AIC(na.hurdle2)
#274714.1; 274787.6

na.hurdle3 <- hurdle((NA_Sales*100)~Platform+Year2+Genre+User_Score+Critic_Score2+Rating2+Publisher2, data = VideoGames2, dist = "negbin")
AIC(na.hurdle); AIC(na.hurdle3)
summary(na.hurdle3)

na.hurdle4 <-  hurdle((NA_Sales*100)~Platform+Year2+Genre+User_Score+Critic_Score2+Rating2+Publisher2 | Platform+Year2+Genre+User_Score+Critic_Score2+Rating2, data = VideoGames2, dist = "negbin")
AIC(na.hurdle3); AIC(na.hurdle4)
#56941.65; 57015.14

eu.hurdle <- hurdle((EU_Sales*100)~Platform+Year2+Genre+User_Score+Critic_Score2+Rating2+Publisher2, data = VideoGames2, dist = "negbin")
summary(eu.hurdle)

eu.hurdle2 <- hurdle((EU_Sales*100)~Platform+Year2+Genre+User_Score+Critic_Score2+Rating2+Publisher2 | Platform+Year2+Genre+Critic_Score2+Rating2, data = VideoGames2, dist = "negbin")
AIC(eu.hurdle); AIC(eu.hurdle2)
#48923.33; 49174.7
```

